!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},a={},n={},r={}.hasOwnProperty,l=/^\.\.?(\/|$)/,o=function(e,t){for(var a,n=[],r=(l.test(t)?e+"/"+t:t).split("/"),o=0,u=r.length;u>o;o++)a=r[o],".."===a?n.pop():"."!==a&&""!==a&&n.push(a);return n.join("/")},u=function(e){return e.split("/").slice(0,-1).join("/")},i=function(t){return function(a){var n=o(u(t),a);return e.require(n,t)}},c=function(e,t){var n=null;n=h&&h.createHot(e);var r={id:e,exports:{},hot:n};return a[e]=r,t(r.exports,i(e),r),r.exports},s=function(e){return n[e]?s(n[e]):e},f=function(e,t){return s(o(u(e),t))},d=function(e,n){null==n&&(n="/");var l=s(e);if(r.call(a,l))return a[l].exports;if(r.call(t,l))return c(l,t[l]);throw new Error("Cannot find module '"+e+"' from '"+n+"'")};d.alias=function(e,t){n[t]=e};var m=/\.[^.\/]+$/,p=/\/index(\.[^\/]+)?$/,v=function(e){if(m.test(e)){var t=e.replace(m,"");r.call(n,t)&&n[t].replace(m,"")!==t+"/index"||(n[t]=e)}if(p.test(e)){var a=e.replace(p,"");r.call(n,a)||(n[a]=e)}};d.register=d.define=function(e,n){if("object"==typeof e)for(var l in e)r.call(e,l)&&d.register(l,e[l]);else t[e]=n,delete a[e],v(e)},d.list=function(){var e=[];for(var a in t)r.call(t,a)&&e.push(a);return e};var h=e._hmr&&new e._hmr(f,d,t,a);d._cache=a,d.hmr=h&&h.wrap,d.brunch=!0,e.require=d}}(),function(){var e;window;require.register("initialize.js",function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=t("lodash/each"),c=n(i),s=t("lodash/omit"),f=n(s),d=t("lodash/isFunction"),m=n(d),p=t("lodash/has"),v=n(p),h=t("lodash/pick"),b=n(h),y=t("lodash/every"),E=n(y),g=t("lodash/min"),w=n(g),S=t("lodash/max"),j=n(S),D=t("lodash/map"),x=n(D),N=t("lodash/sortBy"),q=n(N),T=t("lodash/isUndefined"),k=n(T),_=t("lodash/filter"),O=n(_),C=t("lodash/values"),M=n(C),U=t("lodash/size"),V=n(U),A=t("lodash/isEmpty"),G=n(A),R=t("lodash/keys"),B=n(R),P=t("lodash/get"),L=n(P),I=t("lodash/trimStart"),K=n(I),Y=t("lodash/reduce"),F=n(Y),H=function(){function e(e,t){var a=[],n=!0,r=!1,l=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(i){r=!0,l=i}finally{try{!n&&u["return"]&&u["return"]()}finally{if(r)throw l}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),J=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},X=t("url"),Q=n(X),W=t("base64-js"),Z=n(W),ee=t("fuse.js"),te=n(ee),ae=t("pako"),ne=n(ae),re=t("query-string"),le=n(re),oe=t("copy-to-clipboard"),ue=n(oe),ie=t("reselect"),ce=t("react-dom"),se=t("react"),fe=n(se),de=t("react-bootstrap/lib/Badge"),me=n(de),pe=t("react-bootstrap/lib/Button"),ve=n(pe),he=t("react-bootstrap/lib/Clearfix"),be=n(he),ye=t("react-bootstrap/lib/FormControl"),Ee=n(ye),ge=t("react-bootstrap/lib/FormGroup"),we=n(ge),Se=t("react-bootstrap/lib/Grid"),je=n(Se),De=t("react-bootstrap/lib/InputGroup"),xe=n(De),Ne=t("react-bootstrap/lib/Nav"),qe=n(Ne),Te=t("react-bootstrap/lib/Navbar"),ke=n(Te),_e=t("react-bootstrap/lib/NavItem"),Oe=n(_e),Ce=t("react-bootstrap/lib/Panel"),Me=n(Ce),Ue=t("react-list"),Ve=n(Ue),Ae=t("react-scroll-up"),Ge=n(Ae),Re="DD/MM/YYYY",Be="googleClientLoaded",Pe={yes:1,no:1,opposite:-1,novote:0},Le=function(e){return Z["default"].fromByteArray(ne["default"].deflate(JSON.stringify({_v:1,data:e}),{level:9,memLevel:9}))},Ie=function(e){try{return JSON.parse(ne["default"].inflate(Z["default"].toByteArray(e),{to:"string"}))}catch(t){return null}},Ke=function(e){var t=Q["default"].parse(window.location.href);return delete t.search,t.query=e,Q["default"].format(t)},Ye=function(){return(0,F["default"])(motionIds,function(e,t){return e[t]=null,e},{})},$e=function(){var e=(0,K["default"])(window.location.hash,"#");switch(e){case"about":case"stats":return e;default:return"vote"}},Fe=function(){var e=le["default"].parse(window.location.search),t=e.v,a=e.m,n={};if(t)n.voted=(0,L["default"])(Ie(t),"data"),n.activeTab=st(n)?3:2;else if(a){var r=(0,L["default"])(Ie(a),"data");n.voted=Ye(r),n.activeTab=2}return z({},n,{currentNav:$e()})},He=function(e,t){return(0,L["default"])(t,[e])},Je=function(e){return e.voted},ze=function(e){return e.shortUrls},Xe=(0,ie.createSelector)(Je,ze,function(e,t){return Ke({m:Le((0,B["default"])(e))})}),Qe=(0,ie.createSelector)(Xe,ze,He),We=(0,ie.createSelector)(Je,ze,function(e,t){return Ke({v:Le(e)})}),Ze=(0,ie.createSelector)(We,ze,He),et=(0,ie.createSelector)(Je,We,function(e,t){return!(0,G["default"])(e)&&(0,V["default"])(t)<2048}),tt=(0,ie.createSelector)(function(e){return e.data.motions},function(e){return new te["default"]((0,M["default"])(e),{keys:["title"]})}),at=(0,ie.createSelector)(function(e){return e.data.motions},function(e){return e.startDate},function(e){return e.endDate},function(e){return e.filterText},tt,function(e,t,a,n,r){var l=(0,G["default"])(n)?e:r.search(n),o=(0,O["default"])(l,function(e){return e.voteDateMoment.isBetween(t,a)});return o}),nt=(0,ie.createSelector)(function(e){return e.data.motions},Je,function(e,t){return(0,O["default"])(e,function(e){return!(0,k["default"])((0,L["default"])(t,[e.id]))})}),rt=function(e){return{yes:"no",no:"yes"}[e]},lt=(0,ie.createSelector)(function(e){return e.data.motions},Je,function(e){return e.data.members},function(e,t,a){return(0,q["default"])((0,x["default"])(a,function(e,a){var n=(0,F["default"])(t,function(t,a,n){var r=e.votes[n];return r===a?(t.score+=Pe[a],t[a]+=1):r===rt(a)?(t.score+=Pe.opposite,t.opposite+=1):r&&(t.score+=Pe.novote,t.novote+=1,t[r]+=1),t},{yes:0,no:0,opposite:0,novote:0,absent:0,present:0,abstain:0,score:0});return{name:a,matching:n}}),function(e){return-1*e.matching.score})}),ot=(0,ie.createSelector)(function(e){return e.data.motions},function(e){return(0,x["default"])(e,"voteDateMoment")}),ut=(0,ie.createSelector)(ot,function(e){return(0,j["default"])(e)}),it=(0,ie.createSelector)(ot,function(e){return(0,w["default"])(e)}),ct=(0,ie.createSelector)(Je,function(e){return(0,V["default"])(e)}),st=(0,ie.createSelector)(Je,function(e){return(0,E["default"])(e,Boolean)}),ft=function(e){function t(){return l(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return u(t,e),J(t,[{key:"componentDidMount",value:function(){$(this._input).daterangepicker(z({autoApply:!0,locale:{format:Re}},(0,b["default"])(this.props,["startDate","endDate","minDate","maxDate"]))).on("apply.daterangepicker",this.props.onApply)}},{key:"render",value:function(){var e=this;return fe["default"].createElement("input",{ref:function(t){return e._input=t},type:"text",name:"datefilter",className:"form-control"})}}]),t}(se.Component),dt=function(e){var t=e.onClick;return fe["default"].createElement("button",{type:"button",className:"close pull-right",ariaLabel:"Close",onClick:t},fe["default"].createElement("span",{ariaHidden:"true"},"×"))},mt=function(e){var t=e.motions,a=e.voted,n=e.onVoteYes,r=e.onVoteNo,l=e.onRemoveMotion;return function(e){var o=t[e];return fe["default"].createElement("div",{key:e,className:"form-group list-group-item lead"},fe["default"].createElement("h4",{className:"list-group-item-heading"},fe["default"].createElement(be["default"],{style:{margin:"0.5rem 0 1.5rem"}},(0,v["default"])(a,o.id)&&fe["default"].createElement(dt,{onClick:function(){return l(o.id)}}),fe["default"].createElement("small",{style:{lineHeight:"1.9rem"}},o.voteDate)),o.title),fe["default"].createElement("label",{className:"radio-inline"},fe["default"].createElement("input",{type:"radio",name:o.id,value:"yes",onChange:function(){return n(o)},checked:"yes"===(0,L["default"])(a,o.id)})," 贊成"),fe["default"].createElement("label",{className:"radio-inline"},fe["default"].createElement("input",{type:"radio",name:o.id,value:"no",onChange:function(){return r(o)},checked:"no"===(0,L["default"])(a,o.id)})," 反對"))}},pt=function(e){var t=e.activeTab,a=e.onSelectTab,n=e.votedCount,r=e.isAllVoted,l=n>0&&r;return fe["default"].createElement("header",null,fe["default"].createElement("h2",null,"議案投票"),fe["default"].createElement("p",{className:"lead"},"假如你是立法會議員，你會如何投票？"),fe["default"].createElement(qe["default"],{bsStyle:"tabs",activeKey:t,onSelect:a,justified:!0},fe["default"].createElement(Oe["default"],{eventKey:1},"選取議案"),fe["default"].createElement(Oe["default"],{eventKey:2,disabled:0===n},"你的投票"," ",fe["default"].createElement(me["default"],{className:l?"alert-success":""},n)),fe["default"].createElement(Oe["default"],{eventKey:3,disabled:!l},"配對結果")))},vt=function(e){try{(0,ue["default"])(e)}catch(t){}},ht=function(e){var t=e.url,a=e.shortUrl,n=e.onGenerateShortUrl;return fe["default"].createElement("form",{onSubmit:function(e){e.preventDefault(),a?vt(a):n(t,function(e){vt(e.shortUrl)})}},fe["default"].createElement(we["default"],null,fe["default"].createElement(xe["default"],null,fe["default"].createElement(Ee["default"],{type:"text",value:a||t,readOnly:!0,style:{textOverflow:"ellipsis"}}),fe["default"].createElement(xe["default"].Button,null,fe["default"].createElement(ve["default"],{type:"submit"},"複製短網址")))))},bt=function(e){var t=e.currentNav;return fe["default"].createElement(ke["default"],{staticTop:!0},fe["default"].createElement(ke["default"].Header,null,fe["default"].createElement(ke["default"].Brand,{active:!0},fe["default"].createElement("a",{href:"#"},"立法會投票傾向配對")),fe["default"].createElement(ke["default"].Toggle,null)),fe["default"].createElement(ke["default"].Collapse,null,fe["default"].createElement(qe["default"],null,(0,x["default"])([["vote","議案投票"],["about","關於本網"]],function(e,a){var n=H(e,2),r=n[0],l=n[1];return fe["default"].createElement(Oe["default"],{key:a,eventKey:r,href:"#"+r,active:t===r},l)}))))},yt=function(){return fe["default"].createElement("div",{className:"container"},fe["default"].createElement("h2",null,"關於本網"),fe["default"].createElement("p",{className:"lead"},"本網頁所用之投票資料來自",fe["default"].createElement("a",{href:"http://www.legco.gov.hk/general/chinese/open-legco/open-data.html",rel:"nofollow",target:"_blank"},"立法會網站"),"， 數據及源碼皆於 ",fe["default"].createElement("a",{href:"https://github.com/ec5/election-match/",rel:"nofollow",target:"_blank"},"Github 上公開"),"， 歡迎指正錯漏或提出意見。"))},Et=function(e){function t(e){l(this,t);var a=o(this,Object.getPrototypeOf(t).call(this,e));return a.renderFilterVotesTab=function(){var e=a.state,t=e.data,n=e.voted,r=e.startDate,l=e.endDate,o=at(a.state);return fe["default"].createElement(Me["default"],null,fe["default"].createElement("p",{className:"lead"},"共 ",(0,V["default"])(t.motions)," 個議案，最近更新：",ut(a.state).format(Re),"。"),fe["default"].createElement(ft,{minDate:it(a.state),maxDate:ut(a.state),startDate:r,endDate:l,onApply:function(e,t){a.setState({startDate:t.startDate,endDate:t.endDate})}}),fe["default"].createElement(Ee["default"],{type:"text",placeholder:"輸入關鍵字篩選",value:a.state.filterText,onChange:function(e){return a.setState({filterText:e.target.value})}}),(0,G["default"])(o)?fe["default"].createElement("p",{className:"text-warning"},"沒有議案可投票"):fe["default"].createElement(Ve["default"],{itemRenderer:mt({motions:o,voted:n,onVoteYes:a.onVote("yes"),onVoteNo:a.onVote("no"),onRemoveMotion:a.onRemoveMotion}),length:o.length,type:"simple"}))},a.renderSelectedVotesTab=function(){var e=a.state.voted,t=nt(a.state);return fe["default"].createElement("div",null,et(a.state)&&fe["default"].createElement(ht,{url:Xe(a.state),shortUrl:Qe(a.state),onGenerateShortUrl:a.onGenerateShortUrl}),(0,G["default"])(t)?fe["default"].createElement("p",{className:"text-warning"},"未有投票"):fe["default"].createElement(Ve["default"],{itemRenderer:mt({motions:t,voted:e,onVoteYes:a.onVote("yes"),onVoteNo:a.onVote("no"),onRemoveMotion:a.onRemoveMotion}),length:t.length,type:"simple"}))},a.renderResultTab=function(){var e=lt(a.state);return fe["default"].createElement("div",{className:"table-responsive"},et(a.state)&&fe["default"].createElement(ht,{url:We(a.state),shortUrl:Ze(a.state),onGenerateShortUrl:a.onGenerateShortUrl}),fe["default"].createElement("table",{className:"table table-striped table-hover table-condensed"},fe["default"].createElement("thead",null,fe["default"].createElement("tr",null,fe["default"].createElement("th",null,"議員"),fe["default"].createElement("th",null,"相似分數"),fe["default"].createElement("th",null,"相同投票"),fe["default"].createElement("th",null,"相反投票"),fe["default"].createElement("th",null,"相同贊成"),fe["default"].createElement("th",null,"相同反對"),fe["default"].createElement("th",null,"沒有表態"))),fe["default"].createElement("tbody",null,(0,x["default"])(e,function(e,t){return fe["default"].createElement("tr",{key:t},fe["default"].createElement("td",null,e.name),fe["default"].createElement("td",null,e.matching.score),fe["default"].createElement("td",null,e.matching.yes+e.matching.no),fe["default"].createElement("td",null,e.matching.opposite),fe["default"].createElement("td",null,e.matching.yes),fe["default"].createElement("td",null,e.matching.no),fe["default"].createElement("td",null,e.matching.novote))}))))},a.onGenerateShortUrl=function(e,t){gapi.client.urlshortener.url.insert({resource:{longUrl:e}}).execute(function(n){var l=n.id;if(l){var o=a.state.shortUrls;a.setState({shortUrls:z({},o,r({},e,l))}),(0,m["default"])(t)&&t({shortUrl:l})}})},a.onRemoveMotion=function(e){var t=(0,f["default"])(a.state.voted,e);a.setState({voted:t,activeTab:(0,G["default"])(t)?1:a.state.activeTab})},a.state=z({activeTab:1,filterText:"",isGoogleClientLoaded:!1},Fe()),a}return u(t,e),J(t,[{key:"componentDidMount",value:function(){var e=this;$(window).on(Be,function(){e.setState({isGoogleClientLoaded:!0})}).on("hashchange",function(t){e.setState({currentNav:$e()})}),$.getJSON("data.json",function(t){(0,c["default"])(t.motions,function(e,t){e.id=t,e.group=e.meetingType+" - "+e.voteDate,e.voteDateMoment=moment(e.voteDate,Re)}),e.setState({data:t,startDate:it({data:t}),endDate:ut({data:t})})})}},{key:"render",value:function(){var e=this.state,t=e.currentNav,a=e.data;return a?fe["default"].createElement("div",null,fe["default"].createElement(bt,{currentNav:t}),{vote:this.renderMainSection,stats:this.renderStatsSection,about:this.renderAboutSection}[t].call(this),fe["default"].createElement(Ge["default"],{showUnder:160},fe["default"].createElement("span",null,"移至頂部"))):fe["default"].createElement("div",null,"載入議案資料中⋯⋯")}},{key:"renderMainSection",value:function(){var e=this,t=this.state,a=(t.data,t.activeTab);t.voted;return fe["default"].createElement(je["default"],null,fe["default"].createElement(pt,{activeTab:a,onSelectTab:function(t){return e.setState({activeTab:t})},votedCount:ct(this.state),isAllVoted:st(this.state)}),[this.renderFilterVotesTab,this.renderSelectedVotesTab,this.renderResultTab][a-1].call(this))}},{key:"renderStatsSection",value:function(){return fe["default"].createElement("div",null,"stats")}},{key:"renderAboutSection",value:function(){return fe["default"].createElement(yt,null)}},{key:"onVote",value:function(e){var t=this;return function(a){var n=t.state.voted;t.setState({voted:z({},n,r({},a.id,e))})}}}]),t}(fe["default"].Component),gt=function(){var e="AIzaSyA8f91lvLDPchAInQKcjWX4LXjAiJbDEHo";gapi.client.setApiKey(e),gapi.client.load("urlshortener","v1",function(){$(window).trigger(Be)})};window.initGoogleClient=gt,document.addEventListener("DOMContentLoaded",function(){(0,ce.render)(fe["default"].createElement(Et,null),document.getElementById("app"))})}),require.alias("lodash/lodash.js","lodash"),require.alias("url/url.js","url"),require.alias("base64-js/lib/b64.js","base64-js"),require.alias("fuse.js/src/fuse.js","fuse.js"),require.alias("reselect/lib/index.js","reselect"),require.alias("react/react.js","react"),require.alias("react-bootstrap/lib/index.js","react-bootstrap"),require.alias("react-list/react-list.js","react-list"),require.alias("punycode/punycode.js","punycode"),require.alias("process/browser.js","process"),require.alias("performance-now/lib/performance-now.js","performance-now"),require.alias("react-prop-types/lib/index.js","react-prop-types"),require.alias("warning/browser.js","warning"),require.alias("invariant/browser.js","invariant"),require.alias("react-overlays/lib/index.js","react-overlays"),require.alias("querystring-es3/index.js","querystring"),require.alias("buffer/index.js","buffer"),e=require("process"),require.register("___globals___",function(e,t,a){})}(),require("___globals___");