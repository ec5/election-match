!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},n={},a={},r={}.hasOwnProperty,l=/^\.\.?(\/|$)/,o=function(e,t){for(var n,a=[],r=(l.test(t)?e+"/"+t:t).split("/"),o=0,u=r.length;u>o;o++)n=r[o],".."===n?a.pop():"."!==n&&""!==n&&a.push(n);return a.join("/")},u=function(e){return e.split("/").slice(0,-1).join("/")},i=function(t){return function(n){var a=o(u(t),n);return e.require(a,t)}},s=function(e,t){var a=null;a=v&&v.createHot(e);var r={id:e,exports:{},hot:a};return n[e]=r,t(r.exports,i(e),r),r.exports},c=function(e){return a[e]?c(a[e]):e},f=function(e,t){return c(o(u(e),t))},d=function(e,a){null==a&&(a="/");var l=c(e);if(r.call(n,l))return n[l].exports;if(r.call(t,l))return s(l,t[l]);throw new Error("Cannot find module '"+e+"' from '"+a+"'")};d.alias=function(e,t){a[t]=e};var m=/\.[^.\/]+$/,p=/\/index(\.[^\/]+)?$/,h=function(e){if(m.test(e)){var t=e.replace(m,"");r.call(a,t)&&a[t].replace(m,"")!==t+"/index"||(a[t]=e)}if(p.test(e)){var n=e.replace(p,"");r.call(a,n)||(a[n]=e)}};d.register=d.define=function(e,a){if("object"==typeof e)for(var l in e)r.call(e,l)&&d.register(l,e[l]);else t[e]=a,delete n[e],h(e)},d.list=function(){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e};var v=e._hmr&&new e._hmr(f,d,t,n);d._cache=n,d.hmr=v&&v.wrap,d.brunch=!0,e.require=d}}(),function(){var e;window;require.register("initialize.js",function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=t("lodash/size"),s=a(i),c=t("lodash/each"),f=a(c),d=t("lodash/pick"),m=a(d),p=t("lodash/min"),h=a(p),v=t("lodash/max"),b=a(v),y=t("lodash/reduce"),E=a(y),g=t("lodash/map"),j=a(g),w=t("lodash/sortBy"),D=a(w),x=t("lodash/get"),_=a(x),q=t("lodash/filter"),S=a(q),T=t("lodash/isEmpty"),k=a(T),N=t("lodash/values"),O=a(N),V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},C=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),M=t("reselect"),P=t("react-dom"),Y=t("react"),R=a(Y),A=t("react-bootstrap/lib/Badge"),B=a(A),K=t("react-bootstrap/lib/FormControl"),F=a(K),z=t("react-bootstrap/lib/Nav"),I=a(z),L=t("react-bootstrap/lib/NavItem"),H=a(L),J=t("react-bootstrap/lib/Panel"),U=a(J),G=t("react-list"),Q=a(G),W=t("react-scroll-up"),X=a(W),Z=t("fuse.js"),ee=a(Z),te="DD/MM/YYYY",ne={yes:1,no:1,opposite:-1,novote:0},ae=(0,M.createSelector)(function(e){return e.data.motions},function(e){return new ee["default"]((0,O["default"])(e),{keys:["title"]})}),re=(0,M.createSelector)(function(e){return e.data.motions},function(e){return e.startDate},function(e){return e.endDate},function(e){return e.filterText},ae,function(e,t,n,a,r){var l=(0,k["default"])(a)?e:r.search(a),o=(0,S["default"])(l,function(e){return e.voteDateMoment.isBetween(t,n)});return o}),le=(0,M.createSelector)(function(e){return e.data.motions},function(e){return e.voted},function(e,t){return(0,S["default"])(e,function(e){return(0,_["default"])(t,[e.id])})}),oe=function(e){return{yes:"no",no:"yes"}[e]},ue=(0,M.createSelector)(function(e){return e.data.motions},function(e){return e.voted},function(e){return e.data.members},function(e,t,n){return(0,D["default"])((0,j["default"])(n,function(e,n){var a=(0,E["default"])(t,function(t,n,a){var r=e.votes[a];return r===n?(t.score+=ne[n],t[n]+=1):r===oe(n)?(t.score+=ne.opposite,t.opposite+=1):r&&(t.score+=ne.novote,t.novote+=1,t[r]+=1),t},{yes:0,no:0,opposite:0,novote:0,absent:0,present:0,abstain:0,score:0});return{name:n,matching:a}}),function(e){return-1*e.matching.score})}),ie=(0,M.createSelector)(function(e){return e.data.motions},function(e){return(0,j["default"])(e,"voteDateMoment")}),se=(0,M.createSelector)(ie,function(e){return(0,b["default"])(e)}),ce=(0,M.createSelector)(ie,function(e){return(0,h["default"])(e)}),fe=function(e){function t(){return l(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return u(t,e),C(t,[{key:"componentDidMount",value:function(){$(this._input).daterangepicker(V({autoApply:!0,locale:{format:te}},(0,m["default"])(this.props,["startDate","endDate","minDate","maxDate"]))).on("apply.daterangepicker",this.props.onApply)}},{key:"render",value:function(){var e=this;return R["default"].createElement("input",{ref:function(t){return e._input=t},type:"text",name:"datefilter",className:"form-control"})}}]),t}(Y.Component),de=function(e){var t=e.motions,n=e.voted,a=e.onVoteYes,r=e.onVoteNo;return function(e){var l=t[e];return R["default"].createElement("div",{key:e,className:"form-group list-group-item lead"},R["default"].createElement("h4",{className:"list-group-item-heading"},l.title,R["default"].createElement("div",{style:{textAlign:"right"}},R["default"].createElement("small",null,"投票日期：",l.voteDate))),R["default"].createElement("label",{className:"radio-inline"},R["default"].createElement("input",{type:"radio",name:l.id,value:"yes",onChange:function(){return a(l)},checked:"yes"===(0,_["default"])(n,l.id)})," 贊成"),R["default"].createElement("label",{className:"radio-inline"},R["default"].createElement("input",{type:"radio",name:l.id,value:"no",onChange:function(){return r(l)},checked:"no"===(0,_["default"])(n,l.id)})," 反對"))}},me=function(e){var t=e.activeTab,n=e.onSelectTab,a=e.votedCount;return R["default"].createElement("header",null,R["default"].createElement("h2",null,"議案投票"),R["default"].createElement("p",{className:"lead"},"假如你是立法會議員，你會如何投票？"),R["default"].createElement(I["default"],{bsStyle:"tabs",activeKey:t,onSelect:n},R["default"].createElement(H["default"],{eventKey:1},"選取議案"),a>0&&[R["default"].createElement(H["default"],{key:2,eventKey:2},"你的投票 ",R["default"].createElement(B["default"],null,a)),R["default"].createElement(H["default"],{key:3,eventKey:3},"配對結果")]))},pe=function(e){function t(e){l(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.state={activeTab:1,filterText:""},n}return u(t,e),C(t,[{key:"componentDidMount",value:function(){var e=this;$.getJSON("data.json",function(t){(0,f["default"])(t.motions,function(e,t){e.id=t,e.group=e.meetingType+" - "+e.voteDate,e.voteDateMoment=moment(e.voteDate,te)}),e.setState({data:t,startDate:ce({data:t}),endDate:se({data:t})})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.data,a=t.activeTab,r=t.voted;return n?R["default"].createElement("div",null,R["default"].createElement("section",null,R["default"].createElement(me,{activeTab:a,onSelectTab:function(t){return e.setState({activeTab:t})},votedCount:(0,s["default"])(r)}),[this.renderFilterVotesTab(),this.renderSelectedVotesTab(),this.renderResultTab()][a-1]),R["default"].createElement(X["default"],{showUnder:160},R["default"].createElement("span",null,"移至頂部"))):R["default"].createElement("div",null,"載入議案資料中⋯⋯")}},{key:"renderFilterVotesTab",value:function(){var e=this,t=this.state,n=t.data,a=t.voted,r=t.startDate,l=t.endDate,o=re(this.state);return R["default"].createElement(U["default"],null,R["default"].createElement("p",{className:"lead"},"共 ",(0,s["default"])(n.motions)," 個議案，最近更新：",se(this.state).format(te),"。"),R["default"].createElement(fe,{minDate:ce(this.state),maxDate:se(this.state),startDate:r,endDate:l,onApply:function(t,n){e.setState({startDate:n.startDate,endDate:n.endDate})}}),R["default"].createElement(F["default"],{type:"text",placeholder:"輸入關鍵字篩選",value:this.state.filterText,onChange:function(t){return e.setState({filterText:t.target.value})}}),(0,k["default"])(o)?R["default"].createElement("p",{className:"text-warning"},"沒有議案可投票"):R["default"].createElement(Q["default"],{itemRenderer:de({motions:o,voted:a,onVoteYes:this.onVote("yes"),onVoteNo:this.onVote("no")}),length:o.length,type:"simple"}))}},{key:"renderSelectedVotesTab",value:function(){var e=this.state.voted,t=le(this.state);return R["default"].createElement("div",null,(0,k["default"])(t)?R["default"].createElement("p",{className:"text-warning"},"未有投票"):R["default"].createElement(Q["default"],{itemRenderer:de({motions:t,voted:e,onVoteYes:this.onVote("yes"),onVoteNo:this.onVote("no")}),length:t.length,type:"simple"}))}},{key:"renderResultTab",value:function(){var e=ue(this.state);return R["default"].createElement("div",{className:"table-responsive"},R["default"].createElement("table",{className:"table table-striped table-hover table-condensed"},R["default"].createElement("thead",null,R["default"].createElement("tr",null,R["default"].createElement("th",null,"議員"),R["default"].createElement("th",null,"相似分數"),R["default"].createElement("th",null,"相同投票"),R["default"].createElement("th",null,"相反投票"),R["default"].createElement("th",null,"相同贊成"),R["default"].createElement("th",null,"相同反對"),R["default"].createElement("th",null,"沒有表態"))),R["default"].createElement("tbody",null,(0,j["default"])(e,function(e,t){return R["default"].createElement("tr",{key:t},R["default"].createElement("td",null,e.name),R["default"].createElement("td",null,e.matching.score),R["default"].createElement("td",null,e.matching.yes+e.matching.no),R["default"].createElement("td",null,e.matching.opposite),R["default"].createElement("td",null,e.matching.yes),R["default"].createElement("td",null,e.matching.no),R["default"].createElement("td",null,e.matching.novote))}))))}},{key:"onVote",value:function(e){var t=this;return function(n){var a=t.state.voted;t.setState({voted:V({},a,r({},n.id,e))})}}}]),t}(R["default"].Component);document.addEventListener("DOMContentLoaded",function(){(0,P.render)(R["default"].createElement(pe,null),document.getElementById("app"))})}),require.alias("lodash/lodash.js","lodash"),require.alias("reselect/lib/index.js","reselect"),require.alias("react/react.js","react"),require.alias("react-bootstrap/lib/index.js","react-bootstrap"),require.alias("react-list/react-list.js","react-list"),require.alias("fuse.js/src/fuse.js","fuse.js"),require.alias("process/browser.js","process"),require.alias("base64-js/lib/b64.js","base64-js"),require.alias("performance-now/lib/performance-now.js","performance-now"),require.alias("react-prop-types/lib/index.js","react-prop-types"),require.alias("warning/browser.js","warning"),require.alias("react-overlays/lib/index.js","react-overlays"),require.alias("invariant/browser.js","invariant"),require.alias("buffer/index.js","buffer"),e=require("process"),require.register("___globals___",function(e,t,n){})}(),require("___globals___");