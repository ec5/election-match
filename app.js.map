{"version":3,"sources":["app/initialize.js"],"names":[],"mappings":"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","file":"public/app.js","sourcesContent":["/* globals $,moment */\nimport _ from 'lodash'\n\nimport { createSelector } from 'reselect'\nimport { render } from 'react-dom'\nimport React, { Component } from 'react'\n\nimport Badge from 'react-bootstrap/lib/Badge'\nimport FormControl from 'react-bootstrap/lib/FormControl'\nimport Nav from 'react-bootstrap/lib/Nav'\nimport NavItem from 'react-bootstrap/lib/NavItem'\nimport Panel from 'react-bootstrap/lib/Panel'\n\nimport { AutoSizer, VirtualScroll } from 'react-virtualized'\nimport ReactList from 'react-list'\nimport ScrollToTop from 'react-scroll-up'\n\nimport Fuse from 'fuse.js'\n\nconst DATE_FORMAT = 'DD/MM/YYYY'\nconst scoreAdjustment = {\n  yes: 1,\n  no: 1,\n  opposite: -1,\n  novote: 0,\n}\n\nconst fuseSelector = createSelector(\n  state => state.data.motions,\n  (motions) => {\n    return new Fuse(_.values(motions), { keys: ['title'] })\n  }\n)\n\nconst filterMotionsSelector = createSelector(\n  state => state.data.motions,\n  state => state.startDate,\n  state => state.endDate,\n  state => state.filterText,\n  fuseSelector,\n  (motions, startDate, endDate, filterText, fuse) => {\n    const searchResult = _.isEmpty(filterText) ? motions : fuse.search(filterText)\n    const filteredMotions = _.filter(searchResult, (motion) => {\n      return motion.voteDateMoment.isBetween(startDate, endDate)\n    })\n    return filteredMotions\n  }\n)\n\nconst votedMotionsSelector = createSelector(\n  state => state.data.motions,\n  state => state.voted,\n  (motions, voted) => _.filter(motions, (motion) => {\n    return _.get(voted, [motion.id])\n  })\n)\n\nconst getOppositeVote = (vote) => {\n  return {\n    'yes': 'no',\n    'no': 'yes',\n  }[vote]\n}\n\nconst matchResultSelector = createSelector(\n  state => state.data.motions,\n  state => state.voted,\n  state => state.data.members,\n  (motions, voted, members) => {\n    return _.sortBy(_.map(members, (member, memberName) => {\n      const matching = _.reduce(voted, (r, vote, motionId) => {\n        const memberVote = member.votes[motionId]\n        if (memberVote === vote) {\n          r.score += scoreAdjustment[vote]\n          r[vote] += 1\n        } else if (memberVote === getOppositeVote(vote)) {\n          r.score += scoreAdjustment['opposite']\n          r['opposite'] += 1\n        } else if (memberVote) {\n          r.score += scoreAdjustment['novote']\n          r['novote'] += 1\n          r[memberVote] += 1\n        }\n        return r\n      }, {\n        yes: 0,\n        no: 0,\n        opposite: 0,\n        novote: 0,\n        absent: 0,\n        present: 0,\n        abstain: 0,\n        score: 0,\n      })\n      return {\n        name: memberName,\n        matching,\n      }\n    }), (x) => x.matching.score * -1)\n  }\n)\n\nconst motionDatesSelector = createSelector(\n  state => state.data.motions,\n  (motions) => _.map(motions, 'voteDateMoment')\n)\n\nconst maxDateSelector = createSelector(\n  motionDatesSelector,\n  motionDates => _.max(motionDates)\n)\n\nconst minDateSelector = createSelector(\n  motionDatesSelector,\n  motionDates => _.min(motionDates)\n)\n\nclass DateRangeFilter extends Component {\n  componentDidMount() {\n    $(this._input).daterangepicker({\n      autoApply: true,\n      locale: {\n        format: DATE_FORMAT,\n      },\n      ..._.pick(this.props, [\n        'startDate', 'endDate',\n        'minDate', 'maxDate',\n      ])\n    })\n    .on('apply.daterangepicker', this.props.onApply)\n  }\n\n  render() {\n    return (\n      <input\n        ref={(c) => this._input = c}\n        type=\"text\"\n        name=\"datefilter\"\n        className=\"form-control\"\n      />\n    )\n  }\n}\n\nconst renderMotionVote = ({ motions, voted, onVoteYes, onVoteNo }) => (i) => {\n  const motion = motions[i]\n  return (\n    <div key={i} className=\"form-group list-group-item lead\">\n      <h4 className=\"list-group-item-heading\">\n        {motion.title}\n        <div style={{textAlign: 'right'}}>\n          <small>投票日期：{motion.voteDate}</small>\n        </div>\n      </h4>\n      <label className=\"radio-inline\">\n        <input\n          type=\"radio\"\n          name={motion.id}\n          value=\"yes\"\n          onChange={() => onVoteYes(motion)}\n          checked={_.get(voted, motion.id) === 'yes'}\n        /> 贊成\n      </label>\n      <label className=\"radio-inline\">\n        <input\n          type=\"radio\"\n          name={motion.id}\n          value=\"no\"\n          onChange={() => onVoteNo(motion)}\n          checked={_.get(voted, motion.id) === 'no'}\n        /> 反對\n      </label>\n    </div>\n  )\n}\n\nconst VoteSectionHeader = ({ activeTab, onSelectTab, votedCount }) => {\n  return (\n    <header>\n      <h2>議案投票</h2>\n      <p className=\"lead\">假如你是立法會議員，你會如何投票？</p>\n      <Nav bsStyle=\"tabs\" activeKey={activeTab} onSelect={onSelectTab}>\n        <NavItem eventKey={1}>選取議案</NavItem>\n        {votedCount > 0 && [\n          <NavItem key={2} eventKey={2}>你的投票 <Badge>{votedCount}</Badge></NavItem>,\n          <NavItem key={3} eventKey={3}>配對結果</NavItem>,\n        ]}\n      </Nav>\n    </header>\n  )\n}\n\nclass ElectionMatch extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      activeTab: 1,\n      filterText: '',\n    }\n  }\n\n  componentDidMount() {\n    $.getJSON('data.json', (data) => {\n      _.each(data.motions, (motion, motionId) => {\n        motion.id = motionId\n        motion.group = `${motion.meetingType} - ${motion.voteDate}`\n        motion.voteDateMoment = moment(motion.voteDate, DATE_FORMAT)\n      })\n\n      this.setState({\n        data,\n        startDate: minDateSelector({ data }),\n        endDate: maxDateSelector({ data }),\n      })\n    })\n  }\n\n  render() {\n    const { data, activeTab, voted } = this.state\n    if (!data) {\n      return <div>載入議案資料中⋯⋯</div>\n    }\n    return (\n      <div>\n        <section>\n          <VoteSectionHeader\n            activeTab={activeTab}\n            onSelectTab={(eventKey) => this.setState({ activeTab: eventKey })}\n            votedCount={_.size(voted)}\n          />\n          {[\n            this.renderFilterVotesTab(),\n            this.renderSelectedVotesTab(),\n            this.renderResultTab(),\n          ][activeTab - 1]}\n        </section>\n        <ScrollToTop showUnder={160}>\n          <span>移至頂部</span>\n        </ScrollToTop>\n      </div>\n    )\n  }\n\n  renderFilterVotesTab() {\n    const { data, voted, startDate, endDate } = this.state\n    const motions = filterMotionsSelector(this.state)\n    return (\n      <Panel>\n        <p className=\"lead\">共 {_.size(data.motions)} 個議案，最近更新：{maxDateSelector(this.state).format(DATE_FORMAT)}。</p>\n        <DateRangeFilter\n          minDate={minDateSelector(this.state)}\n          maxDate={maxDateSelector(this.state)}\n          startDate={startDate}\n          endDate={endDate}\n          onApply={(ev, picker) => {\n            this.setState({\n              startDate: picker.startDate,\n              endDate: picker.endDate,\n            })\n          }}\n        />\n        <FormControl\n          type=\"text\"\n          placeholder=\"輸入關鍵字篩選\"\n          value={this.state.filterText}\n          onChange={(event) => this.setState({ filterText: event.target.value })}\n        />\n        {_.isEmpty(motions) ? <p className=\"text-warning\">沒有議案可投票</p> : (\n          <ReactList\n            itemRenderer={renderMotionVote({\n              motions,\n              voted,\n              onVoteYes: this.onVote('yes'),\n              onVoteNo: this.onVote('no'),\n            })}\n            length={motions.length}\n            type='simple'\n          />\n        )}\n      </Panel>\n    )\n  }\n\n  renderSelectedVotesTab() {\n    const { voted } = this.state\n    const motions = votedMotionsSelector(this.state)\n    return (\n      <div>\n        {_.isEmpty(motions) ? <p className=\"text-warning\">未有投票</p> : (\n          <ReactList\n            itemRenderer={renderMotionVote({\n              motions,\n              voted,\n              onVoteYes: this.onVote('yes'),\n              onVoteNo: this.onVote('no'),\n            })}\n            length={motions.length}\n            type='simple'\n          />\n        )}\n      </div>\n    )\n  }\n\n  renderResultTab() {\n    const matchResult = matchResultSelector(this.state)\n    return (\n      <div className=\"table-responsive\">\n        <table className=\"table table-striped table-hover table-condensed\">\n          <thead>\n            <tr>\n              <th>議員</th>\n              <th>相似分數</th>\n              <th>相同投票</th>\n              <th>相反投票</th>\n              <th>相同贊成</th>\n              <th>相同反對</th>\n              <th>沒有表態</th>\n            </tr>\n          </thead>\n          <tbody>\n            {_.map(matchResult, (member, i) => {\n              return (\n                <tr key={i}>\n                  <td>{member.name}</td>\n                  <td>{member.matching.score}</td>\n                  <td>{member.matching.yes + member.matching.no}</td>\n                  <td>{member.matching.opposite}</td>\n                  <td>{member.matching.yes}</td>\n                  <td>{member.matching.no}</td>\n                  <td>{member.matching.novote}</td>\n                </tr>\n              )\n            })}\n          </tbody>\n        </table>\n      </div>\n    )\n  }\n\n  onVote(vote) {\n    return (motion) => {\n      const { voted } = this.state\n      this.setState({ voted: {\n          ...voted,\n          [motion.id]: vote,\n      }})\n    }\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  render(<ElectionMatch />, document.getElementById('app'))\n})\n"]}